apiVersion: v1
kind: ConfigMap
metadata:
  name: cm-k8smgr-files-<ID>
binaryData:
  # Oneliner to get binary data from input directory:
  # tar -czf files.tar.gz files && base64 -w 0 files.tar.gz && echo && rm files.tar.gz
  files.tar.gz: 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
---
apiVersion: v1
kind: Service
metadata:
  name: svc-k8smgr-<ID>
spec:
  selector:
    app: deployment-k8smgr-<ID>
  ports:
    - name: https
      protocol: TCP
      port: 8080
      targetPort: 8080
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: deployment-k8smgr-<ID>
  labels:
    app: deployment-k8smgr-<ID>
spec:
  replicas: 1
  selector:
    matchLabels:
      app: deployment-k8smgr-<ID>
  template:
    metadata:
      labels:
        app: deployment-k8smgr-<ID>
    spec:
      imagePullSecrets:
        - name: gitlab-registry
      serviceAccountName: "svc-acc-k8smgr-<ID>"
      containers:
        - name: deployment-k8smgr-<ID>
          image: registry.jsc.fz-juelich.de/jupyterjsc/k8s/images/k8s-service-manager:latest
          imagePullPolicy: Always
          command: ["/bin/bash"]
          args:
            - -c
            - >-
                tar -xzf /tmp/files.tar.gz -C /tmp &&
                /bin/bash /home/k8smgr/web/entrypoint.sh
          env:
            - name: CONFIG_PATH
              value: "/tmp/files/config.json"
            - name: DEPLOYMENT_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.labels['app']
            - name: DEPLOYMENT_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
          volumeMounts:
            - name: files
              mountPath: "/tmp/files.tar.gz"
              subPath: files.tar.gz
      securityContext:
        fsGroup: 100
      volumes:
        - name: files
          configMap:
            defaultMode: 400
            name: cm-k8smgr-files-<ID>
